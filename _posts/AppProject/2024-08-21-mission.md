---
layout: single
title:  "[힛더북] 4. 개인 미션 기능 CRUD 작성 - 1"
categories: "AppProject"
sidebar_main: true

---

도메인형 구조의 개인 미션 기능 CRUD 작성
{: .notice--danger}

### CRUD 작업하기 전 고민

먼저, <https://uttermost-fountain-86b.notion.site/4dc04d5960ec4cacb1223d33b4ab1e9c> 해당 기획자님의 IA를 보고 개인 미션 기능을 구현하려고 했다.

UI & UX를 글로 표현해서 그런지 생각보다 화면 구성이 쏙쏙 되지 않았고 어떤 API를 구현해야 할 지 고민이 필요했다.

다른 누군가가 기능을 기획하고 거기에 맞춰 개발을 하는 것이 아직 어색했고, 전공이 개발쪽이 아니신 분이였기 때문에 기능에 대한 타협과 소통이 필요하다고 느꼈다.

개발에 들어가기 전에, 내가 IA를 제대로 이해했는지 & 기획자가 원하는 기능이 이게 맞는지 알기 위해 개인적으로 연락을 드렸다.

내가 고민했던 점은,

> 💡 1. 미션 기간 2. 미션 내용 3. 지정 요일 을 받아 미션을 추가하는 API를 먼저 만들어야 하는데 나중에 해당 미션의 달성률을 표시하려면, 미션 완료 여부를 표시할 필요가 있다고 생각했다. 그래서 지금 미션 Entity의 필드가 저렇게 이뤄져있다면, 미션 기간 안의 매일매일을 다시 관리해야 하니 연결된 또 다른 Entity가 필요했고 그걸 미션 이벤트 Entity로 지정했다.
>
> 근데, 여기서 고민점은 달성률 계산에 대해서였다. 달성률을 총 기간에서 미션 성공 일수로 구해야하는데 굳이 미션 기간 중 실패한 날짜도 DB를 통해 관리가 필요한지에 대해서였다.
>
> 예를 들어, 사용자가 미션 기간을 1년으로 두고 평일 내내 미션을 등록했다고 치면 7일 중 5일이 평일이니까 1년이면 약 260일 정도가 평일이고 그럼 그 한 사용자의 한 미션에만 260개의 데이터를 DB에 저장해 "성공 OR 실패" 로 관리를 해야하는데, 나중에 실제 어플이 사용된다고 하면 성능적으로 괜찮을지 걱정이 되었다. 아직 대용량 데이터 처리에 대해서도 잘 모르고 Redis 같은 캐시도 적용해보지 않아 더 그랬던 거 같다.

이 고민을 기획자님과 소통해보고 싶어 "미션 실패에 대한 패널티" 기능을 추후에 염두에 두고 계시거나 생각해보신 적이 있냐고 여쭤보았다. 만약, 이런 기능이 필요하면 무조건 모든 기간에 대한 데이터를 관리해야하고 일단 기능을 구현한 뒤, 대용량 데이터 처리에 대해 적용해도 된다고 생각했다. 이 부분에 대해서는 다른 서비스가 어떻게 운영되고 있는지 찾아보고 싶다고 하셔서 다음 회의때 논의 하기로 했다.

그래서 같이 백엔드 파트를 맡은 분에게 조언을 구했고, 지금 생각하기에 단순 for문으로 구현하는 게 성능적으로 괜찮을 거 같아 일단 작업에 들어가기로 했다.

그래도 나름대로 Spring에서 지원하는 @Async로 비동기 작업을 수행하게 했는데, 지금 생각해보니 테스트를 해봐야겠다고 생각이 들었다.

<br/>

<hr/>

### Helper

✅ 앞에서 내가 고민했던 부분에 대한 로직을 수행하는 Helper만 보자면, 미션 추가를 하고 프론트에 응답을 보낸 다음 DB에 미션 이벤트 데이터가 수행되도록 `@Async` 를 이용했다.

처음에는 모든 기간에 대한 데이터를 생성했는데, 사실 기간 중 지정 요일에 대한 데이터만 필요하니까 미션 기간 중 지정 요일에 대한 날짜들만 미션 이벤트 테이블에서 관리되도록 구현했다.



<script src="https://gist.github.com/Hanseung2/2dd113e804bc15e3a686a5ebbf2a1243.js"></script>

<br/>

이렇게 1차 개인 미션 기능을 만들었고, 이제

1. 해당 날짜에 따른 미션 목록 불러오기
2. 미션 달성률 계산하기
3. 달성률이 저조한 미션에 대한 알람을 AOP를 이용해 구현하기

이렇게 개인 미션 기능들이 남았다. 차근차근 해보자!

