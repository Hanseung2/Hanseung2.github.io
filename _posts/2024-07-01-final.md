---
layout: single
title:  "[Capstone] [실시간 지하철 지연 예측 서비스] 3. 최종 발표 후 회고"
categories: Capstone





---



4학년 1학기 Capstone디자인(산학협력프로젝트)에 대한 고민과 방향성
{: .notice--danger}



### 사용 데이터

![image-20240702183529839](/assets/images/20240701/img1.png){: width="600" height="700"}

![image-20240702183617028](/assets/images/20240701/img2.png){: width="600" height="700"}

![image-20240702183700702](/assets/images/20240701/img3.png){: width="600" height="700"}

![image-20240702183719011](/assets/images/20240701/img4.png){: width="600" height="700"}

![image-20240702183735175](/assets/images/20240701/img5.png){: width="600" height="700"}
<br/>
<hr/>

### 우리가 지연 예측을 하는 방법

 주제를 받고 '실시간 지연 예측' 을 어떻게 할 것인지 많은 고민이 있었다. 현재 수도권에서 운행하는 지하철 노선은 정말 많았고 역도 굉장히 많았다. 하지만, 그에 대한 데이터는 많지 않았다.

 먼저, `지연 시간` 이란 <span style="background-color:#fff5b1">'사용자가 목적지까지 실제 도착한 시간 - 예상 도착 시간'</span> 이라고 생각했다. 그럼 '연간 지하철 역마다의 평균 소요 시간' 이라던지 '월간 지하철 지연 시간' 이라던지 통계성 데이터가 필요했는데, 이에 대한 데이터는 아예 찾을 수 없었다. 우리가 시간에 대한 정보를 얻을 수 있었던 데이터는 `실시간 도착 시간` 밖에 없었고 이것도 호출 시간에 대해 몇 분 뒤에 도착하는지에 대한 정보였다. 그래서 이 API를 계속 호출해 데이터를 수집해야하는 상황이었다.

 그럼 이 실시간 도착정보만으로 '사용자가 목적지까지 실제 도착한 시간 - 예상 도착 시간'을 알아내야 했고 우린 이 실시간 도착정보를 사용자가 목적지까지 실제 도착한 시간으로 간주했다. 실제 근처 역에 대한 실시간 도착 정보 API를 호출하니 네이버의 열차 도착 시간과 같았다. 그리고 예상 도착 시간은 열린데이터광장에서 제공하는 '역간 소요 시간' 데이터를 사용했다.

 정리하면, 우리는 `지연 시간`에 대한 데이터를 학습시켜 이것을 예측하는 것이 아니라 실제 역에 도착했던 시간들을 학습시켜 사용자의 경로의 총 시간을 예측해 주어진 데이터 상 총 시간과 비교해 `지연 시간`을 알아내고자 하였다. 어떻게 보면 주제와 조금 다를 수 있지만 교수님께서 주제는 원하는대로 분석해 서비스를 만들어도 된다고 하셨기 때문에 우리가 가진 데이터로는 최선의 방법이었다고 생각한다.
<p align="center">
  <img src="/assets/images/20240701/flow.JPG" width="400" height="500">
  <br/>
  &lt;지연 예측 과정&gt;
</p>

<br/>
<hr/>

### 첫 프로젝트를 마무리하고 느낀점

첫 프로젝트를 하고 나니 프로젝트를 진행해보는 것이 얼마나 중요한지 알았다.
백엔드에 대해 아무것도 알지 못해 외부 강의를 보며 Dockerfile 작성부터 여기까지 왔던 것이 뿌듯하기도 했지만, 한편으론 부족한 점이 너무 많았다.

#### <span style="background-color:#fff5b1">부족했던 점</span>

먼저, 중간 발표를 마치고 AWS EC2를 이용해 배포를 진행하고 CI/CD 까지 해보려고 했다. 이때를 위해 `docker-compose.yml` 도 작성했고 Docker에 대한 지식을 쌓았던 거 같다. 하지만, free tier의 성능에서는 도저히 `./gradlew build`가 되지 않고 서버가 멈추는 현상이 발생했다. 구글링해서 Swap Memory를 할당하는 방법까지 진행해봤지만, 좀처럼 되지 않아 배포를 진행해보지 못했다.

여기서 문제점은, 처음에 Spring과 React를 하나의 파일로 합치는 `build.gradle` 파일에 있었던 거 같다. 이게 무슨 뜻이냐면 React에서 만든 정적 페이지를 복사해 받아와서 Spring의 정적 페이지로 쓰는 대신 Spring 포트인 8080에서도 React의 웹페이지를 연동해 볼 수 있는 장점이 있었는데 단점으로는 gradlew build로 생성된 .jar 파일의 파일 크기가 너무 커졌고 빌드 속도도 느렸다. 그냥 jar 파일을 github에 업로드해서 EC2 안에서 clone 해볼까도 생각했지만, 크기가 너무 커서 git lfs 라는 것을 이용해야된다고 로그가 떴었는데 모처럼 쉽게 되지 않았다.

이러한 문제점 때문에, 로컬 서버 상에서만 확인할 수 밖에 없는 문제로 이어졌고 내 컴퓨터에 AI model의 python 코드, React의 js 파일들을 다 받아 같이 빌드하고 웹사이트가 잘 동작하는지 테스트를 해야됐었다. 이런 이유로 테스트 코드, CI/CD, 배포 등이 얼마나 중요한지 몸소 느꼈다. 정말 아쉬웠던 점은 EC2 서버에 대한 학교 지원 공지가 뒤늦게 올라와 free tier 보다 좋은 tier를 사용해보지 못했다는 점도 있다..

그리고, 데이터베이스에 대한 문제다. 지하철 역에 대한 데이터가 워낙 많다보니 데이터베이스를 필수로 이용해야 할 거 같아 MySQL 컨테이너를 미리 구성해놓기도 했고 `docker-compose.yml` 에도 다 작성했었는데 데이터가 일관되지 않았다. 제공되는 데이터의 지하철역 이름이 각기 다 달라 일관성에 문제가 생겼고 FE에서 사용하는 데이터와 API, BE에서 사용하는 데이터와 API도 다 달랐기 때문에 서로 말을 맞춰 일관되게 수정해야됐다. 그래서 일단 json 파일과 Map으로 구성된 java 파일로 만들어 데이터를 서로 수정하고 서비스를 만들었다. 
